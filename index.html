<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Mole</title>
    <style>
        /* RESET & BASE STYLES */
        * { box-sizing: border-box; touch-action: manipulation; }
        body {
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
            user-select: none;
        }

        /* SCREENS */
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-y: auto; /* Allow scrolling for rules if needed */
        }
        .active { display: flex; }

        /* TYPOGRAPHY */
        h1 { font-size: 2.5rem; margin-bottom: 10px; color: #ff5252; }
        h2 { font-size: 1.8rem; margin-bottom: 20px; }
        p { font-size: 1.1rem; color: #bbbbbb; margin-bottom: 20px; max-width: 320px; line-height: 1.5; }
        
        ul { text-align: left; max-width: 320px; color: #ccc; margin-bottom: 30px; padding-left: 20px; }
        li { margin-bottom: 10px; line-height: 1.4; }

        .big-text {
            font-size: 3rem;
            font-weight: bold;
            color: #4caf50;
            margin: 20px 0;
        }

        .mole-text { color: #ff5252; } 

        /* CONTROLS */
        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            background: #333;
            border: 2px solid #555;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 60px;
            margin-bottom: 10px;
        }
        
        button:active { transform: scale(0.95); background: #444; }
        
        button.primary {
            background-color: #ff5252;
            border-color: #ff5252;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
            padding: 20px;
            font-size: 1.5rem;
        }

        button.secondary {
            background: transparent;
            border: 1px solid #444;
            color: #888;
            font-size: 1rem;
            padding: 10px 20px;
        }

        /* CARD REVEAL AREA */
        #card-area {
            background: #1e1e1e;
            width: 100%;
            max-width: 350px;
            height: 300px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 2px dashed #444;
            flex-direction: column;
        }

        .hidden-content { display: none; }
        .visible-content { display: flex; flex-direction: column; align-items: center;}

        /* TIMER */
        #timer-display {
            font-size: 5rem;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen active">
        <h1>THE MOLE</h1>
        <p>Pass the phone. Find the liar.</p>
        
        <div class="control-group">
            <button onclick="adjustPlayers(-1)">-</button>
            <h2 id="player-count">4 Players</h2>
            <button onclick="adjustPlayers(1)">+</button>
        </div>

        <button class="primary" onclick="startGame()">Start Game</button>
        <button class="secondary" onclick="switchScreen('rules-screen')">How to Play</button>
    </div>

    <div id="rules-screen" class="screen">
        <h2>How to Play</h2>
        <ul>
            <li><strong>The Secret:</strong> Everyone is at the same Location (e.g., "The Beach"), except for one person: <strong>The Mole</strong>.</li>
            <li><strong>The Pass:</strong> Pass the phone. Hold the button to see your role. Don't let anyone else see!</li>
            <li><strong>The Game:</strong> Once the timer starts, ask each other questions. 
                <br><em>"Is it hot here?" "Why are you wearing that?"</em></li>
            <li><strong>The Goal:</strong> 
                <br>- <strong>Civilians:</strong> Vote to identify the Mole.
                <br>- <strong>Mole:</strong> Blend in, or guess the Location correctly to steal the win.</li>
        </ul>
        <button class="primary" onclick="switchScreen('setup-screen')">Back</button>
    </div>

    <div id="pass-screen" class="screen">
        <h2 id="player-instruction">Pass to Player 1</h2>
        
        <div id="card-area">
            <div id="state-hidden" class="visible-content">
                <p>Tap & Hold button below to see your role.</p>
            </div>
            
            <div id="state-revealed" class="hidden-content">
                <span style="font-size: 1rem; color: #888;">LOCATION:</span>
                <div id="role-display" class="big-text">???</div>
            </div>
        </div>

        <button id="reveal-btn" class="primary" 
                onmousedown="showRole()" onmouseup="hideRole()" onmouseleave="hideRole()"
                ontouchstart="showRole()" ontouchend="hideRole()">
            HOLD TO REVEAL
        </button>

        <button id="next-btn" onclick="nextPlayer()" style="margin-top: 20px; display: none;">
            Next Player >
        </button>
    </div>

    <div id="game-screen" class="screen">
        <h2>Discuss!</h2>
        <p>Ask questions. Find the Mole.</p>
        <div id="timer-display">08:00</div>
        <button class="primary" onclick="endGame()">Reveal Location</button>
    </div>

    <div id="result-screen" class="screen">
        <h2>Game Over</h2>
        
        <p>The Location was:</p>
        <div id="reveal-location" class="big-text">LOCATION</div>
        
        <p>The Mole was:</p>
        <div id="reveal-mole" class="big-text mole-text">Player X</div>

        <button class="primary" onclick="resetGame()">Play Again</button>
    </div>

<script>
    // --- DATA ---
    const locations = [
        "Airplane", "Bank", "Beach", "Broadway Theater", "Casino", "Cathedral", 
        "Circus Tent", "Corporate Party", "Crusader Army", "Day Spa", "Embassy", 
        "Hospital", "Hotel", "Military Base", "Movie Studio", "Ocean Liner", 
        "Passenger Train", "Pirate Ship", "Polar Station", "Police Station", 
        "Restaurant", "School", "Service Station", "Space Station", "Submarine", 
        "Supermarket", "University", "Zoo"
    ];

    // --- STATE ---
    let playerCount = 4;
    let currentPlayer = 0;
    let moleIndex = 0;
    let currentLocation = "";
    let timerInterval;

    // --- DOM ELEMENTS ---
    const screens = {
        setup: document.getElementById('setup-screen'),
        rules: document.getElementById('rules-screen'),
        pass: document.getElementById('pass-screen'),
        game: document.getElementById('game-screen'),
        result: document.getElementById('result-screen')
    };

    // --- FUNCTIONS ---

    function switchScreen(screenId) {
        Object.values(screens).forEach(s => s.classList.remove('active'));
        // Handle direct ID or short name
        if(screens[screenId]) {
            screens[screenId].classList.add('active');
        } else if (document.getElementById(screenId)) {
            document.getElementById(screenId).classList.add('active');
        }
    }

    function adjustPlayers(num) {
        playerCount += num;
        if (playerCount < 3) playerCount = 3;
        if (playerCount > 15) playerCount = 15;
        document.getElementById('player-count').innerText = playerCount + " Players";
    }

    function startGame() {
        // Reset Logic
        currentPlayer = 1;
        moleIndex = Math.floor(Math.random() * playerCount) + 1; // 1-based index
        currentLocation = locations[Math.floor(Math.random() * locations.length)];
        
        // UI Reset
        updatePassScreen();
        switchScreen('pass-screen');
    }

    function updatePassScreen() {
        document.getElementById('player-instruction').innerText = `Pass to Player ${currentPlayer}`;
        document.getElementById('reveal-btn').style.display = 'block';
        document.getElementById('next-btn').style.display = 'none';
        
        // Reset card state
        document.getElementById('state-hidden').style.display = 'flex';
        document.getElementById('state-revealed').style.display = 'none';
    }

    function showRole() {
        const roleDisplay = document.getElementById('role-display');
        const stateHidden = document.getElementById('state-hidden');
        const stateRevealed = document.getElementById('state-revealed');

        stateHidden.style.display = 'none';
        stateRevealed.style.display = 'flex';

        if (currentPlayer === moleIndex) {
            roleDisplay.innerText = "YOU ARE THE MOLE";
            roleDisplay.classList.add('mole-text');
        } else {
            roleDisplay.innerText = currentLocation;
            roleDisplay.classList.remove('mole-text');
        }
    }

    function hideRole() {
        document.getElementById('state-hidden').style.display = 'flex';
        document.getElementById('state-revealed').style.display = 'none';
        
        // Once they let go, allow them to move to next player
        document.getElementById('reveal-btn').style.display = 'none';
        document.getElementById('next-btn').style.display = 'inline-block';
    }

    function nextPlayer() {
        currentPlayer++;
        if (currentPlayer > playerCount) {
            startTimer();
        } else {
            updatePassScreen();
        }
    }

    function startTimer() {
        switchScreen('game-screen');
        let duration = 8 * 60; // 8 minutes
        const display = document.getElementById('timer-display');
        
        clearInterval(timerInterval);
        updateTimerDisplay(duration, display);

        timerInterval = setInterval(() => {
            duration--;
            updateTimerDisplay(duration, display);
            if (duration <= 0) {
                clearInterval(timerInterval);
            }
        }, 1000);
    }

    function updateTimerDisplay(seconds, displayElement) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        displayElement.innerText = `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
    }

    function endGame() {
        clearInterval(timerInterval);
        document.getElementById('reveal-location').innerText = currentLocation;
        document.getElementById('reveal-mole').innerText = `Player ${moleIndex}`;
        switchScreen('result-screen');
    }

    function resetGame() {
        switchScreen('setup-screen');
    }
</script>
</body>
</html>
